## 🧩 基本設計書：センサーデータ分析システム

---

### 🎯 システム概要
工場のセンサーデータ（CSV/ZIP）を定型的に処理し、DuckDBに保存・管理することで、技術者や分析担当者が効率よく可視化・分析に活用できるようにする。

---

### 👤 対象ユーザー
- 工場の現場技術者
- データ分析担当者

---

### 📌 システム構成（概要）
- **入力**：センサーデータファイル（CSV または ZIP）
- **処理**：ファイル探索、グルーピング、整形、マッチング、登録
- **出力**：DuckDBへの保存、処理ログファイル出力

---

### 🗃️ テーブル設計（主要）

#### 1. `sensor_data`
| カラム名 | 型 | 説明 |
|----------|----|------|
| timestamp | TIMESTAMP | 測定時刻 |
| parameter_id | TEXT | センサーID |
| parameter_name | TEXT | センサー名称 |
| unit | TEXT | 単位（例：℃） |
| value | TEXT | 計測値（TEXTで保存） |
| source_file | TEXT | 元ファイルパス |
| sensor_type | TEXT | センサーの種別 |

#### 2. `processed_file_periods`
| カラム名 | 型 | 説明 |
|----------|----|------|
| source_file | TEXT | 処理元ファイル |
| source_zip | TEXT | ZIPファイル名（該当あれば） |
| event | TEXT | イベント名称 |
| start_time | TIMESTAMP | 処理済み期間開始 |
| end_time | TIMESTAMP | 処理済み期間終了 |

#### 3. `sensor_master`
| カラム名 | 型 | 説明 |
|----------|----|------|
| parameter_id | TEXT | センサーID（主キー） |
| parameter_name | TEXT | センサー名 |
| unit | TEXT | 単位（例：℃, kPa） |
| sensor_type | TEXT | センサーの種別（温度, 振動など） |
| description | TEXT | 補足説明（任意） |

---

### 📥 入力仕様
- ユーザー指定：`target_folder`, `name_patterns`, `encoding`, `db_path`
- ラベル情報：工場名、機械番号、任意説明
- イベント情報：複数イベント対応（名前＋期間）

---

### 📤 出力仕様
- `sensor_data` テーブル更新
- `processed_file_periods` への処理記録
- `sensor_master` へのマスターデータ登録（任意・今後導入）
- `tqdm.write()`＋ファイルログ出力（実行状況・スキップ・エラーなど）

---

### 🔗 外部連携・想定拡張
- 今後のUIツール連携（分析画面・抽出機能）
- JSON API経由での出力形式調整
- センサーマスタテーブルとの照合／メタ情報管理

---

### ⛳ ユースケース概要
1. ユーザーが対象フォルダとファイル指定
2. センサーデータファイルをZIPも含めて探索
3. ファイル名からセンサー情報抽出しグルーピング
4. イベント情報と突き合わせて対象範囲を限定
5. 整形して縦持ちデータに変換
6. DuckDBへ登録・ログ出力・履歴更新

---

※この文書は「要件定義書 v2」に基づき構成されています。

